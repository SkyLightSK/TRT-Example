<div class="budget-overview-widget">
  <div class="card-header">
    <h2>Budget Overview</h2>
  </div>
  
  <div class="card-content">
    <ng-container *ngIf="!loading; else loadingTemplate">
      <div *ngIf="budgetStats" class="budget-stats">
        <div class="stats-row">
          <div class="stat-item">
            <div class="stat-value">{{formatCurrency(budgetStats.totalAllocated)}}</div>
            <div class="stat-label">Total Budget</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value">{{formatCurrency(budgetStats.totalSpent)}}</div>
            <div class="stat-label">Spent To Date</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-value">{{formatPercentage(budgetStats.overallUtilization)}}</div>
            <div class="stat-label">Budget Utilization</div>
          </div>
        </div>
        
        <div class="budget-progress">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="budgetStats.overallUtilization"></div>
          </div>
          <div class="progress-labels">
            <span>0%</span>
            <span>50%</span>
            <span>100%</span>
          </div>
        </div>
        
        <div *ngIf="budgetStats.yearlyTrends && budgetStats.yearlyTrends.length" class="yearly-trends">
          <div class="trends-header">
            <h3>Yearly Budget Trends</h3>
            <div class="year-filters">
              <button 
                *ngFor="let year of availableYears" 
                class="year-filter-btn" 
                [class.active]="selectedYears.includes(year)"
                (click)="toggleYearFilter(year)">
                {{year}}
              </button>
            </div>
          </div>
          
          <div class="trends-chart">
            <div class="chart-bars">
              <div *ngFor="let trend of getFilteredTrends()" class="chart-bar-group">
                <div class="chart-bar total" [style.height]="getTrendBarHeight(trend)">
                  <div class="spent-overlay" [style.height]="getSpentBarHeight(trend)"></div>
                </div>
                <div class="bar-label">{{trend.year}}</div>
              </div>
            </div>
            <div class="chart-legend">
              <div class="legend-item">
                <div class="legend-color total"></div>
                <span>Total Budget</span>
              </div>
              <div class="legend-item">
                <div class="legend-color spent"></div>
                <span>Spent to Date</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-container>
    
    <ng-template #loadingTemplate>
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <p>Loading budget data...</p>
      </div>
    </ng-template>
  </div>
  
  <div class="card-footer">
    <a routerLink="/budget" class="view-details-link">View budget details</a>
  </div>
</div>
